<div class="catalogo-store">
  <!-- Header tipo Mercado Libre: logo + búsqueda -->
  <header class="store-header">
    <div class="store-header-inner">
      <a class="store-brand" href="/catalogo" aria-label="Productos Chinos - Inicio">
        <img src="/icono.png" alt="" class="store-logo-img" width="44" height="44">
        <span class="store-brand-name">Productos Chinos</span>
      </a>
      <div class="store-header-search">
        <label for="catalogoSearch" class="visually-hidden">Buscar productos</label>
        <input
          type="search"
          id="catalogoSearch"
          class="store-search-input"
          placeholder="Buscar productos, marcas y más..."
          [ngModel]="searchTerm()"
          (ngModelChange)="searchTerm.set($event)"
          autocomplete="off">
        <button type="button" class="store-search-btn" aria-label="Buscar">
          <i class="fas fa-search" aria-hidden="true"></i>
        </button>
      </div>
      <span class="store-tagline">Catálogo en línea</span>
    </div>
  </header>

  <!-- Contenido principal: menú hamburguesa + grid en todos los tamaños -->
  <main class="store-main">
    <div class="store-container store-layout">
      @if (vistaCatalogo$ | async; as vista) {
        <div class="store-content">
          @if (vista.categorias.length > 1) {
            <!-- Botón filtro categorías + limpiar: visible en móvil, tablet y web -->
            <div class="store-filter-wrap">
              <div class="store-filter-row">
                <button
                  type="button"
                  class="store-filter-btn"
                  (click)="toggleCategoriasDropdown()"
                  [attr.aria-expanded]="showCategoriasDropdown()"
                  aria-haspopup="true"
                  aria-label="Filtrar por categoría">
                  <i class="fas fa-filter store-filter-btn-icon" aria-hidden="true"></i>
                  <span class="store-filter-label">{{ categoriasButtonLabel(vista) }}</span>
                </button>
                @if (selectedCategoria()) {
                  <button type="button" class="store-filter-clear" (click)="setCategoriaAndClose('')" aria-label="Limpiar filtro">
                    <i class="fas fa-times" aria-hidden="true"></i>
                    <span>Limpiar filtro</span>
                  </button>
                }
              </div>
            </div>

            <!-- Panel lateral tipo hamburguesa (móvil, tablet y web) -->
            @if (showCategoriasDropdown()) {
              <div class="store-drawer-backdrop" (click)="setCategoriaAndClose(selectedCategoria())" aria-hidden="true"></div>
              <aside class="store-drawer" role="dialog" aria-label="Categorías" [class.is-open]="showCategoriasDropdown()">
                <div class="store-drawer-header">
                  <h2 class="store-drawer-title">Categorías</h2>
                  <button type="button" class="store-drawer-close" (click)="setCategoriaAndClose(selectedCategoria())" aria-label="Cerrar menú">
                    <i class="fas fa-times" aria-hidden="true"></i>
                  </button>
                </div>
                <nav class="store-drawer-nav">
                  @for (c of vista.categorias; track c.value) {
                    <button
                      type="button"
                      class="store-drawer-option"
                      [class.active]="selectedCategoria() === c.value"
                      (click)="setCategoriaAndClose(c.value)">
                      {{ c.label }}
                    </button>
                  }
                </nav>
              </aside>
            }
          }
          @if (vista.productos.length === 0) {
            <div class="store-empty">
              <div class="store-empty-icon">
                <i class="fas fa-search" aria-hidden="true"></i>
              </div>
              <h2 class="store-empty-title">No hay productos</h2>
              <p class="store-empty-text">{{ searchTerm() ? 'No encontramos resultados para tu búsqueda. Probá con otros términos.' : (selectedCategoria() ? 'No hay productos en esta categoría.' : 'Pronto tendremos novedades.') }}</p>
            </div>
          } @else {
            <div class="store-results-bar">
              <p class="store-results-count">{{ vista.productos.length }} producto{{ vista.productos.length !== 1 ? 's' : '' }}</p>
            </div>
            <div class="store-grid">
              @for (p of vista.productos; track p.id) {
                <article class="product-card">
                  <a class="product-card-link" href="#" (click)="$event.preventDefault()">
                    <div class="product-card-image-wrap">
                      @if (imagenPrincipal(p); as src) {
                        <img class="product-card-image" [src]="src" [alt]="p.nombreProducto || 'Producto'" loading="lazy">
                      } @else {
                        <div class="product-card-placeholder">
                          <i class="fas fa-image" aria-hidden="true"></i>
                        </div>
                      }
                      <span class="product-card-badge" [class.badge-devolucion]="p.conDevolucion">{{ etiquetaGanancia(p) }}</span>
                    </div>
                    <div class="product-card-body">
                      <h2 class="product-card-title">{{ p.nombreProducto || 'Sin nombre' }}</h2>
                      <p class="product-card-price">{{ formatPrecio(p.precioPagina) }}</p>
                    </div>
                  </a>
                </article>
              }
            </div>
          }
        </div>
      }
    </div>
  </main>

  <footer class="store-footer">
    <div class="store-container">
      <div class="store-footer-inner">
        <img src="/icono.png" alt="" class="store-footer-logo" width="32" height="32">
        <p class="store-footer-text">© Productos Chinos — Catálogo en línea</p>
      </div>
    </div>
  </footer>
</div>
